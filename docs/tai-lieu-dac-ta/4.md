https://www.drawdb.app/editor?shareId=8cdf48a664df3bcd49d402582d541f21

CREATE TABLE IF NOT EXISTS "users" (
	"id" SERIAL,
	"full_name" VARCHAR(255) NOT NULL,
	"phone_number" VARCHAR(20) NOT NULL UNIQUE,
	"email" VARCHAR(255),
	"password_hash" VARCHAR(255) NOT NULL,
	"role" VARCHAR(50) DEFAULT 'resident',
	"created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "apartments" (
	"id" SERIAL,
	"unit_number" VARCHAR(50) NOT NULL,
	"floor_number" INTEGER,
	"block_name" VARCHAR(50),
	"owner_id" INTEGER,
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "fee_types" (
	"id" SERIAL,
	"name" VARCHAR(100) NOT NULL,
	"unit_price" DECIMAL(10,2),
	"measure_unit" VARCHAR(50),
	"description" TEXT,
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "bills" (
	"id" SERIAL,
	"apartment_id" INTEGER,
	"fee_type_id" INTEGER,
	"title" VARCHAR(255) NOT NULL,
	"amount" DECIMAL(15,2) NOT NULL,
	"period" DATE NOT NULL,
	"due_date" DATE NOT NULL,
	"status" VARCHAR(50) DEFAULT 'pending',
	"created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "transactions" (
	"id" SERIAL,
	"bill_id" INTEGER,
	"user_id" INTEGER,
	"paid_amount" DECIMAL(15,2) NOT NULL,
	"payment_date" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	"payment_method" VARCHAR(50),
	"transaction_ref" VARCHAR(100),
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "notifications" (
	"id" SERIAL,
	"user_id" INTEGER,
	"title" VARCHAR(255) NOT NULL,
	"content" TEXT NOT NULL,
	"is_read" BOOLEAN DEFAULT false,
	"type" VARCHAR(50) DEFAULT 'reminder',
	"created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "maintenance_requests" (
	"id" SERIAL,
	"user_id" INTEGER,
	"apartment_id" INTEGER,
	"title" VARCHAR(255) NOT NULL,
	"description" TEXT,
	"status" VARCHAR(50) DEFAULT 'pending',
	"image_url" TEXT,
	"created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMP,
	PRIMARY KEY("id")
);




CREATE TABLE IF NOT EXISTS "announcements" (
	"id" SERIAL,
	"title" VARCHAR(255) NOT NULL,
	"content" TEXT NOT NULL,
	"author_id" INTEGER,
	"published_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	"priority" VARCHAR(50) DEFAULT 'normal',
	PRIMARY KEY("id")
);



ALTER TABLE "apartments"
ADD FOREIGN KEY("owner_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "bills"
ADD FOREIGN KEY("apartment_id") REFERENCES "apartments"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "bills"
ADD FOREIGN KEY("fee_type_id") REFERENCES "fee_types"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "transactions"
ADD FOREIGN KEY("bill_id") REFERENCES "bills"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "transactions"
ADD FOREIGN KEY("user_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "notifications"
ADD FOREIGN KEY("user_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "maintenance_requests"
ADD FOREIGN KEY("user_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "maintenance_requests"
ADD FOREIGN KEY("apartment_id") REFERENCES "apartments"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "announcements"
ADD FOREIGN KEY("author_id") REFERENCES "users"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;

